# 编程导航

> 发现优质编程学习资源


## 已有功能

### 资源

**主页**

**资源推荐**

根据用户兴趣和资源质量推荐资源

![主页-推荐资源](https://qiniuyun.code-nav.cn/%E4%B8%BB%E9%A1%B5-%E6%8E%A8%E8%8D%90%E8%B5%84%E6%BA%90.png)

**资源大全**

分页展示资源，可一键跳转至源站点。

![资源大全](/Users/yupili/Pictures/%E7%BC%96%E7%A8%8B%E5%AF%BC%E8%88%AA%E9%A1%B9%E7%9B%AE/%E4%B8%BB%E7%AB%99/%E8%B5%84%E6%BA%90%E5%A4%A7%E5%85%A8.png)

**资源搜索**

快速从整个站点搜索资源，并记录搜索历史，便于再次检索。

![资源搜索](https://qiniuyun.code-nav.cn/%E8%B5%84%E6%BA%90%E6%90%9C%E7%B4%A2.png)

**资源筛选**

支持按专栏、标签进行灵活筛选。标签分组展示，并支持搜索，提高检索效率。

![资源筛选](https://qiniuyun.code-nav.cn/%E8%B5%84%E6%BA%90%E7%AD%9B%E9%80%89.png)

**资源排序**

支持按照发布时间、评价、收藏进行排序。

![资源排序](https://qiniuyun.code-nav.cn/%E8%B5%84%E6%BA%90%E6%8E%92%E5%BA%8F.png)

**推荐资源**

允许用户推荐资源，填写标签、上传资源图等，审核通过后公开可见。

![资源推荐](https://qiniuyun.code-nav.cn/%E8%B5%84%E6%BA%90%E6%8E%A8%E8%8D%90.png)

**相似检测**

提供一层自动过滤，防止推荐重复资源。

![资源推荐-相似检测](https://qiniuyun.code-nav.cn/%E8%B5%84%E6%BA%90%E6%8E%A8%E8%8D%90-%E7%9B%B8%E4%BC%BC%E6%A3%80%E6%B5%8B.png)

**资源详情页**

支持记录和展示资源浏览量、收藏资源、分享资源、一键聚合搜索等，并提供相似资源推荐。

![资源详情浏览](https://qiniuyun.code-nav.cn/%E8%B5%84%E6%BA%90%E8%AF%A6%E6%83%85%E6%B5%8F%E8%A7%88.png)

**举报资源**

支持用户自主举报违规或过期资源，需要审核。

![资源举报](https://qiniuyun.code-nav.cn/%E8%B5%84%E6%BA%90%E4%B8%BE%E6%8A%A5.png)

**评论及打分**

用户可以对资源进行评论和打分，帮助其他用户判断资源的质量和适用性。

![评论及打分](https://qiniuyun.code-nav.cn/%E8%AF%84%E8%AE%BA%E5%8F%8A%E6%89%93%E5%88%86.png)

**评论列表**

分页浏览评论，并支持点赞。

![评论列表](https://qiniuyun.code-nav.cn/%E8%AF%84%E8%AE%BA%E5%88%97%E8%A1%A8.png)



### 用户

**扫码登录**

用不起短信，就选择了扫码登录的方式，关注公众号后将自动注册，并得到动态码，可输入动态码登录。登录有效期 30 天，避免重复登录。

![](https://qiniuyun.code-nav.cn/%E6%89%AB%E7%A0%81%E7%99%BB%E5%BD%95.png)


**个人资料**

包括用户基本信息、积分、等级、称号、兴趣等。

![用户中心](https://qiniuyun.code-nav.cn/%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83.png)

**设置兴趣**

用户可以选择兴趣，从而进入站点时得到更适合自己的资源推荐。

![设置兴趣](https://qiniuyun.code-nav.cn/%E8%AE%BE%E7%BD%AE%E5%85%B4%E8%B6%A3.png)

**收藏夹**

用户可以收藏资源，便于查找。

![收藏夹](https://qiniuyun.code-nav.cn/%E6%94%B6%E8%97%8F%E5%A4%B9.png)

**推荐记录**

用户可以查看自己推荐过的资源，并对被审核拒绝的资源进行修改。

![推荐记录](https://qiniuyun.code-nav.cn/%E6%8E%A8%E8%8D%90%E8%AE%B0%E5%BD%95.png)

**消息通知**

集中管理系统发送的消息，支持搜索、标为已读、删除，右上角将显示用户未读消息数。

![消息通知](https://qiniuyun.code-nav.cn/%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5.png)



### 世界

**激励榜**

包括实时总积分榜、积分周榜、月榜等，可自由选择统计周期。

![激励榜](https://qiniuyun.code-nav.cn/%E6%BF%80%E5%8A%B1%E6%A6%9C.png)

#### 找伙伴

类似于一个广场，用户可以介绍自己，找到更多学习编程、志同道合的朋友。

**伙伴列表**

支持搜索、点赞、复制联系方式，帮助找到合适的伙伴。

![发布自我介绍](https://qiniuyun.code-nav.cn/%E6%89%BE%E4%BC%99%E4%BC%B4.png)

**发布自我介绍**

![发布自我介绍](https://qiniuyun.code-nav.cn/%E5%8F%91%E5%B8%83%E8%87%AA%E6%88%91%E4%BB%8B%E7%BB%8D.png)



### 运营中心

管理员或运营同学才有权限操作，用于维护站内秩序、优化资源、发布公告等。

**资源审核**

左侧列表点选资源，管理员可在右侧执行修改、通过、拒绝等操作。

![资源审核](https://qiniuyun.code-nav.cn/%E8%B5%84%E6%BA%90%E5%AE%A1%E6%A0%B8.png)

**评论审核**

![评论审核](https://qiniuyun.code-nav.cn/%E8%AF%84%E8%AE%BA%E5%AE%A1%E6%A0%B8.png)

**举报审核**

![举报审核](https://qiniuyun.code-nav.cn/%E4%B8%BE%E6%8A%A5%E5%AE%A1%E6%A0%B8.png)

**标签刷新**

一键将旧标签统一合并为新标签。

![](https://qiniuyun.code-nav.cn/%E6%A0%87%E7%AD%BE%E5%88%B7%E6%96%B0.png)



#### 云图库

集中管理站内图片，方便用户在推荐资源时选择。

![云图库](https://qiniuyun.code-nav.cn/%E4%BA%91%E5%9B%BE%E5%BA%93.png)

**上传图片**

![云图库-图片上传](https://qiniuyun.code-nav.cn/%E4%BA%91%E5%9B%BE%E5%BA%93-%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0.png)



**世界公告**

管理员可添加实时公告，当前在线的所有用户都能立刻浏览到。

![世界公告](https://qiniuyun.code-nav.cn/%E4%B8%96%E7%95%8C%E5%85%AC%E5%91%8A.png)


<br/>

## 快速开始

**请保证 Node.js 版本 > 10** ⚠️

1. 下载项目到本地

   ```bash
   git clone https:// github.com/liyupi/CodeNav.git
   ```

2. 安装依赖

   ```bash
   npm install
   ```

3. 本地启动项目

   ```bash
   npm run start
   ```

4. 点击右下角 `Umi UI` 按钮，可快速新建页面，海量模板供选择。访问 localhost:3000 可使用 UMI 控制台。

   

   ![仅开发环境可见的 Umi UI 按钮](./assets/umiButton.png)

   ![从模板新建页面](./assets/umiTmp.png)

   如果模板图标无法加载，请在本地配置 hosts：`151.101.64.133 raw.githubusercontent.com`

   **新建页面后，如果要在菜单列表中显示，要在 `config/menu.tsx` 中添加配置。**

5. 打包构建

   ```bash
   npm run build
   ```

   会生成 dist 目录，可以通过 [serve 工具 ](https://www.npmjs.com/package/serve)本地启动 server 快速浏览。

6. 部署

   提供多种部署方式：

   1. 容器（推荐）：项目已提供 `Dockerfile` 可以轻松构建 `Docker` 镜像，并将容器部署在[云托管服务](https://cloud.tencent.com/document/product/876/46901)中，实现动态扩缩容。
   2. 目录：直接将 `dist` 目录放到 `Nginx` 等 web 服务器上，配置 `nginx.conf` 即可。
   3. 静态站点托管：可以直接将 `dist` 目录发布到[静态站点托管](https://cloud.tencent.com/document/product/876/46900)中，有 CDN 支持
   4. 测试环境一行命令发布：`tcb framework deploy --mode test`
      
      测试环境域名：https://test-env.code-nav.cn
<br/>

## 技术栈

### 前端

前端使用 [Ant Design Pro V4](https://pro.ant.design/docs/getting-started-cn/) 后台管理模板，提升了百倍开发效率，**但是也踩了不少坑**~

1. [Umi](https://umijs.org/zh-CN) + React 前端框架
2. [Ant Design](https://ant.design/index-cn) 组件库 + [Ant Design Pro 高级组件](https://procomponents.ant.design/components)
3. [Dva](https://dvajs.com/) 数据状态管理
4. [Less](http://lesscss.cn/) CSS 预处理语言
5. TypeScript 静态类型检查



### 后端

> 代码目录：[cloudfunctions](cloudfunctions/README.md)

后端使用 [腾讯云云开发](https://cloud.tencent.com/product/tcb)，全量上云，充分利用了腾讯云提供的云计算能力。

1. 云数据库：配合 SDK 使用，无需编写重复的增删改查，提高开发效率，自动备份
2. 云存储：配合 SDK 使用，易接入
3. 云函数：开发复杂的函数，Serverless 架构，无需自行管理，可开放 Http 访问服务
4. 云托管：容器技术，弹性伸缩、动态扩缩容
5. 腾讯云 CMS 开箱即用的后台管理

<br/>

## 目录结构

```
.
├── Dockerfile 容器构建文件
├── Dockerfile.build 容器构建文件（包含 npm 打包流程）
├── README.md 项目说明
├── cloudbaserc.json 腾讯云云开发文件，需要用 tcb 根据自己的环境生成
├── cloudfunctions 后端云函数
│   └── helloworld
├── config 配置
│   ├── config.ts 全局配置
│   ├── defaultSettings.ts 框架默认设置
│   ├── menu.tsx 菜单列表
│   ├── proxy.ts 代理
│   └── routes.ts 定义路由
├── docker 容器所需配置文件
│   └── nginx.conf 服务器配置
├── jsconfig.json 编译配置
├── mock 假数据
│   ├── forms.ts
│   ├── resources.ts
│   ├── tags.ts
│   └── user.ts
├── package.json 包管理文件
├── public 公共目录
│   └── logo.png
├── src 前端项目主目录
│   ├── assets 资源文件
│   ├── cardList.less 卡片样式
│   ├── components 组件
│   ├── constant 常量
│   ├── global.less 全局样式
│   ├── global.tsx 全局入口
│   ├── layouts 布局
│   ├── manifest.json
│   ├── models 数据模型
│   ├── pages 页面
│   ├── service-worker.js 缓存
│   ├── services 业务请求
│   ├── tcb.js 腾讯云云开发 SDK
│   ├── typings.d.ts 类型定义
│   └── utils 工具
└── tsconfig.json
```

<br/>

## 技巧
1. 业务 LoadingLayout 实现加载前置条件

## 技术

1. 全局 LoadingLayout 实现云开发前置加载
2. prerender SEO 优化
3. 域名重定向
4. redis 限流
5. 小程序环境互通
6. 聚合查询
7. 分层架构
8. 数据库索引

## 登录逻辑

### WEB 端登录

1. 公众号关注或点击 “一键登录” 时，请求微信公众号后台服务，获得 unionId \ userInfo 信息
2. 微信公众号后台服务带着 unionId \ userInfo 调用 getCaptcha 接口，生成验证码并返回给用户
3. 用户在 web 端手动输入验证码，调用 login 接口，后端注册自定义登录态，并返回 access_token 给前端，前端显示登录成功
4. 之后的请求，前端带着 access_token 调用云函数，即可在云函数中拿到当前用户登录态

### 小程序端登录

> 复用 WEB 端登录逻辑

1. 小程序启动时调用小程序的 login 云函数，拿到 unionId \ miniOpenId
2. 用户点击 “一键登录”，获得 userInfo 信息
3. 小程序前端带着 unionId \ userInfo 调用 getCaptcha 接口，生成验证码并返回给前端（用户不可见）
4. 前端带着验证码，调用 login 接口，后端注册自定义登录态，并返回 access_token 给前端，前端显示登录成功
5. 之后的请求，前端带着 access_token 调用云函数，即可在云函数中拿到当前用户登录态

## 云函数调用（传参方式）

1. HTTP（接收参数方式不同）
2. 本地
3. 内部
4. SDK 调用
